$("table").hide();$("#insurance, #card, #cheque, #mpesa").hide();$(document).ready(function(){var c=3;$("#add_row").click(function(){var f='<td><select name="item'+c+'"  id="item_'+c+'" class=" select2-single" style="width: 100%"></select></td><td><input type="text" name=\'qty'+c+"' id='item_qty_"+c+"'  placeholder='Quantity' value=\"0\" class=\"quantities\"/><span id='fb"+c+"'></span></td><td><span id=\"original"+c+'">0</span></td><td><input type="text" name=\'price'+c+"' placeholder='Price'/></td> <td><input type=\"text\" name='dis"+c+"' placeholder='Discount' value=\"0\"/></td></td><td><span id=\"total"+c+'">0.00</span></td><td><button class="btn btn-xs btn-danger remove"><i class="fa fa-trash-o"></i></button></td>';$("#addr"+c).html(f);$("#tab_logic").append('<tr id="addr'+(c+1)+'"></tr>');b(c);c++});function a(){var f=0;var g=0;$("#tab_logic tbody tr").each(function(j,p){var q=$(p);var o=q.find("input[name=qty"+j+"]").val();var l=q.find("input[name=price"+j+"]").val();var h=q.find("input[name=dis"+j+"]").val();var n=o*l;var k=0;try{k=(o*h*l)/100}catch(m){k=0}if(k){g+=parseInt(k)}if(n){f+=parseInt(n);$("#total"+j).html(n-parseInt(k))}});$("#total").html((f-g).toFixed(2));$("#discount").html(g.toFixed(2));$("#net").html((f-g).toFixed(2));$("#amnt").val((f-g).toFixed(2));$("#sum").html(f.toFixed(2))}function b(f){$("#addr"+f+" select").select2({theme:"classic",placeholder:"Please select an item",formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(g,h){return"Please enter "+(h-g.length)+" more characters"},formatInputTooLong:function(h,g){return"Please enter "+(h.length-g)+" less characters"},formatSelectionTooBig:function(g){return"You can only select "+g+" items"},formatLoadMore:function(g){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumInputLength:2,allowClear:true,ajax:{url:PRODUCTS_URL,dataType:"json",cache:true,data:function(g,h){return{term:g}},results:function(h,g){return{results:h}}}});$("#addr"+f+" select").on("select2:select",function(h){var i=$(this).find("option:selected");var j=i.data().data.cash_price;var g=i.data().data.available;if(INSURANCE){j=i.data().data.credit_price}$("#fb"+f).attr("available",g);$("input[name=price"+f+"]").val(j);$("#original"+f).html(i.data().data.o_price);a()});$("#addr"+f+" input").keyup(function(){a()});$(".remove").click(function(g){g.preventDefault();$(this).closest("tr").remove();a()})}b(0);b(1);b(2);$("select[name=payment_mode]").change(function(){e($(this).val())});$("#phone1, #phone").keyup(function(){$.ajax({type:"get",url:PHONE_URL,data:{type:"phone",key:$(this).val()},beforeSend:function(){$("#phone").css("background","#FFF")},success:function(f){$("#suggesstion-box").show();$("#suggesstion-box").html(f);$("#suggesstion-box1").show();$("#suggesstion-box1").html(f);$("#phone").css("background","#FFF")}})});$("#payment_mode").change(function(){mode=$(this).val();INSURANCE=(mode==="insurance")});function e(f){$("#cash, #insurance, #card, #cheque, #mpesa").hide();$("#"+f).show();if(f==="insurance"){$("#customer").hide()}else{$("#customer").show()}}function d(g){$("#scheme").empty();var f="";var h=$(g).val();if(!h){return}$.ajax({url:SCHEMES_URL,data:{id:h},success:function(i){$.each(i,function(j,k){f+='<option value="'+j+'">'+k+"</option>"});$("#scheme").html(f)}})}$("#company").change(function(){d(this)});$("body").on("keyup",".quantities",function(){var h=$(this).closest("tr").find("select").find("option:selected");var j=h.data().data.id;var g=$(this).attr("id");var f=g.substring(g.lastIndexOf("_")+1);try{var i=parseInt($("#fb"+f).attr("available"))}catch(k){i=0}if(i>0){if($(this).val()>i){message="<i class='fa fa-times' style='color:red'></i> Only "+i+" available. <a target='blank' href='/inventory/store/products/adjust/"+j+"'> adjust?</a>"}else{message="<i class='fa fa-check' style='color:green'></i> "+i+" avaialable"}}else{message="<i class='fa fa-times' style='color:red'></i> Out of stock! <a target='blank' href='/inventory/store/products/adjust/"+j+"'> adjust?</a>"}$("#fb"+f).html(message)});$("table").show()});function setValue(a,c,d,b){$("#email").val(c);$("#phone").val(a);$("#phone1").val(a);$("#fname").val(d);$("#lname").val(b);$("#suggesstion-box").hide();$("#email1").val(c);$("#phone1").val(a);$("#phone1").val(a);$("#fname1").val(d);$("#lname1").val(b);$("#suggesstion-box1").hide()};