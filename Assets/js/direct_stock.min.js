$("table").hide();$(document).ready(function(){$("body").on("focus",".datepicker",function(){$(this).datepicker({dateFormat:"yy-mm-dd",minDate:0})});function a(){var e=0;var d=[];$("#tab_logic tbody tr").each(function(j,n){var o=$(n);var m=parseInt(o.find("input[name=qty"+j+"]").val());var k=parseInt(o.find("input[name=price"+j+"]").val());var g=parseFloat(o.find("input[name=dis"+j+"]").val());var p=parseInt(o.find("input[name=package"+j+"]").val());var l=0;var h=0;if(m&&k){if(p){m=p*m}l=m*k;if(!l){l=0}var h=(g/100).toFixed(2);if(!h){h=0}var f=Math.floor(l-(h*l));$("#total"+j).html(f);d.push({qty:m,price:k,total:l,rate:h,net:f});e+=f;console.log(e)}});$("#total").html(e);console.info(d)}$("#tab_logic input").keyup(function(){a()});var c=1;$("#add_row").click(function(){var d="<td><select name='item"+c+"' class='select2-single' style='width: 100%'></select></td><td><input type='text' name='package"+c+"' value='1' placeholder='Packaging' size='2'/></td><td><input type='text' name='qty"+c+"' size='2' value='1'/></td><td><input type='text' name='bonus"+c+"' value='0' size='2'/></td><td><input class='datepicker' type='text' id='expiry"+c+"' name='expiry"+c+"' placeholder='Expiry Date'/></td><td><input type='text' name='price"+c+"' size='4'/></td><td><input type='text' name='dis"+c+"' value='0' size='2'/></td><td><span id='total"+c+"'>0</span></td>";$("#addr"+c).html(d);$("#tab_logic").append('<tr id="addr'+(c+1)+'"></tr>');b(c);c++});function b(d){$("#addr"+d+" select").select2({theme:"classic",placeholder:"Please select an item",formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,f){return"Please enter "+(f-e.length)+" more characters"},formatInputTooLong:function(f,e){return"Please enter "+(f.length-e)+" less characters"},formatSelectionTooBig:function(e){return"You can only select "+e+" items"},formatLoadMore:function(e){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumInputLength:2,allowClear:true,ajax:{url:PRODUCTS_URL,dataType:"json",cache:true,data:function(e,f){return{term:e}},results:function(f,e){return{results:f}}}});$("#addr"+d+" select").on("select2:select",function(e){var f=$(this).find("option:selected");var g=f.data().data.prices.price;$("input[name=price"+d+"]").val(g);a()});$("#addr"+d+" input").keyup(function(){a()});$(".remove").click(function(f){f.preventDefault();$(this).closest("tr").remove();a()})}b(0);$("table").show()});